## hash 专题知识点汇总

[TOC]



哈希算法，也称为哈希函数，是一种数学函数，它接受任意大小的输入数据并输出固定大小的字符串，称为哈希值或摘要。哈希算法的主要特征是它是一个单向函数，这意味着从输入数据计算哈希值很容易，但从哈希值计算输入数据在计算上是不可行的。

### 1、常用 hash 算法用例及简介

哈希算法有许多常见用途，包括：

1. 数据完整性验证：可以使用哈希值来验证文件或消息在传输或存储期间没有被更改。接收方可以计算接收数据的哈希值，并将其与预期哈希值进行比较，以确保数据未被篡改。
2. 密码存储：哈希算法通常用于以安全的方式存储密码。不存储密码本身，而是存储密码的哈希值。当用户输入密码时，将计算哈希值并将其与存储的哈希值进行比较。如果它们匹配，则认为密码正确。
3. 数字签名：哈希算法通常用于数字签名方案中，以提供消息认证和不可否认性。发送方可以计算消息的哈希值，然后使用其私钥加密哈希值。然后，接收方可以计算接收到的消息的哈希值，用发送方的公钥解密加密的哈希值并比较这两个哈希值，以确保消息没有被更改并且确实是由发送方发送的。

有许多常见的哈希算法，包括：

1. MD5: MD5 算法产生 128 位哈希值，广泛用于数据完整性验证和密码存储。然而，由于发现了各种漏洞，它被认为是不安全的。
2. SHA-1: SHA-1 算法产生 160 位哈希值，通常用于数字签名和数据完整性验证。然而，它也被认为是不安全的，并且正在逐步淘汰，取而代之的是更新的算法。
3. SHA-256: SHA-256 算法产生 256 位哈希值，被认为对大多数应用程序是安全的。它广泛用于数据完整性验证、密码存储和数字签名。
4. Blake2: Blake2 算法产生可变长度（最多 512 位）的散列值，以其高性能和强安全性财产而闻名。它广泛用于数据完整性验证和密码存储。

总体而言，哈希算法是**现代密码学**的基本组成部分，在计算机安全和数据完整性方面有许多重要应用。

### 2、针对相似度检索的 hash 方法

在**文本领域**，一些常见的文本 Hash 方法：

1. Simhash：Simhash 是一种基于局部敏感哈希（LSH）的方法，它将文本表示为一个长度为 k 的二进制码，其中每个位置都是根据文本的内容和权重计算出来的。这个方法能够保留文本的重要信息，同时减小相似文本之间的差异，从而提高了相似度检索的效果。
2. MinHash：MinHash 是一种用于文本去重和相似度检索的方法，它将文本表示为一个固定长度的签名。该方法先将文本划分为多个 shingle（即文本的连续子序列），然后用一个哈希函数对每个 shingle 进行哈希，得到一个数字。最终，MinHash 选取签名中的 k 个最小数字，作为文本的表示。
3. LSH：LSH 是一种将相似项目高概率映射到同一存储桶的技术。通过将文本文档视为高维向量，它已被应用于文本哈希。

在**图像领域**，一些常见的图像 Hash 方法：

1. 随机投影
2. 傅里叶变换
3. Perceptual Hashing：Perceptual Hashing（感知哈希）是一种基于人类视觉感知特性的图像 Hash 方法。该方法将图像转换为灰度图像，并将其缩小到固定大小，然后使用离散余弦变换（DCT）将其转换为频域。最终，Perceptual Hashing 选取频域中的一些系数，并根据它们的正负号产生一个二进制码。
4. Difference Hashing：Difference Hashing（差异哈希）是一种简单但有效的图像 Hash 方法。该方法将图像转换为灰度图像，并将其缩小到固定大小，然后计算相邻像素之间的差异。最终，Difference Hashing 将差异转换为二进制码。

#### 2.1 随机投影

随机投影是一种用于机器学习、计算机科学和数据分析的强大技术。它涉及将高维数据投影到低维空间，同时保留原始数据的某些几何性质。这是通过使用随机线性映射来实现的，该映射将原始数据映射到具有较低维度的新空间。

随机投影**在数据是高维的应用中特别有用**，这意味着它具有大量的特征或维度。在这种情况下，传统算法在计算上可能变得不可行或容易过度拟合。通过使用随机投影来降低数据的维数，我们可以简化问题并使其更易于处理。

随机投影的一个应用是图像哈希，这是一种用于识别相似图像的技术。其基本思想是使用随机投影将每个图像转换为固定长度的二进制代码，然后将其用作指纹来比较和识别图像。

为了了解随机投影在图像哈希中的作用，让我们考虑一个简化的示例。假设我们有一张分辨率为 $100 \times 100$ 像素的灰度图像。图像中的每个像素可以采用 0 到 255 之间的值，因此图像有 $100 \times 100 \times 256=2560000$ 种可能的配置。如果我们将每个构型表示为高维空间中的一个点，我们最终会得到非常多的维度。

为了降低图像的维数，我们可以使用随机投影。我们首先生成一个维数为 $k \times n$ 的随机矩阵，其中 $k$ 是所需的低维空间，$n$ 是图像的原始维数。然后，我们将随机矩阵乘以图像向量，以获得具有 $k$ 维的新向量。这个新向量表示低维空间中的图像。

随机投影矩阵通常是使用高斯分布等分布生成的，这样可以确保投影保留原始数据的某些几何性质。具体地，投影确保原始高维空间中任意两点之间的距离在低维空间中近似保持。

为了从低维向量生成二进制代码，我们只需对每个维度设置阈值即可获得二进制值。例如，如果维度的值大于零，我们将其设置为 1；否则，我们将其设置为 0。这将产生表示图像的固定长度二进制代码。

随机投影的技术原理可以使用以下数学公式来描述：

设 $X$ 是 $n$ 维的高维向量，设 $R$ 是 $k \times n$ 随机投影矩阵。$X$ 在低维空间上的投影由 $Y=RX$ 给出，其中 $Y$是 $k$ 维向量。

为了从低维向量 $Y$ 获得二进制码，我们可以使用以下阈值函数：
$$
f(Y_i)= \begin{cases} 1, & \text {if $Y_i > 0$} \\ 0, & \text{otherwise} \end{cases}
$$
这里的 $Y_i$ 是 $Y$ 的第 $i$ 维度。

在图像哈希中，可以使用简单的汉明距离度量来比较由随机投影生成的二进制码。两个二进制码之间的汉明距离只是它们之间不同的位数。如果两个图像具有相似的二进制代码，则它们很可能是相似的图像。

除了图像哈希，随机投影还有许多其他应用，包括聚类、分类和降维。它是一种强大而灵活的技术，可以应用于机器学习和数据分析中的广泛问题。

```python
# 随机投影的示例代码
import numpy as np
from PIL import Image

# Load image
img = Image.open('example_image.jpg').convert('L') # convert to grayscale
width, height = img.size

# Convert image to numpy array
img_array = np.array(img)

# Generate random projection matrix
n_components = 256
projection_matrix = np.random.randn(width*height, n_components)

# Project image onto random matrix
img_projected = np.dot(img_array.flatten(), projection_matrix)

# Compute binary hash from projected image
threshold = 0
img_hash = np.where(img_projected > threshold, 1, 0)

print(img_hash)
```



#### 2.2 傅里叶变换

傅里叶变换是一种强大的数学技术，用于信号处理、图像处理和许多其他领域。它将信号或图像分解为其组成频率，允许我们在频域中分析和处理信号。

傅里叶变换背后的基本思想是将信号或图像表示为具有不同频率、振幅和相位的正弦波和余弦波的总和。这种表示允许我们根据其频率内容来分析信号或图像，这在图像滤波、压缩和特征提取等应用中通常很有用。

傅里叶变换的一个应用是图像哈希，这是一种用于识别相似图像的技术。其基本思想是使用傅里叶变换将每个图像转换为固定长度的二进制代码，然后将其用作指纹来比较和识别图像。

为了了解傅里叶变换在图像哈希中的工作原理，让我们考虑一个简化的示例。假设我们有一张分辨率为 $100 \times 100$ 像素的灰度图像。图像中的每个像素的值可以介于 0 和 255 之间，因此图像有 $100 \times 100=10000$ 种可能的配置。如果我们将每个构型表示为高维空间中的一个点，我们最终会得到非常多的维度。

为了降低图像的维数，我们可以使用傅里叶变换。我们首先对图像进行二维傅里叶变换，将图像从空间域转换为频率域。2D 傅里叶变换由以下方程给出：
$$
\begin{equation} F(u,v) = \iint_{-\infty}^{\infty} f(x,y) e^{-i 2 \pi (ux+vy)} dx dy \end{equation}
$$
其中，$f(x,y)$ 是位置 $(x,y)$ 处的图像强度，$F(u,v)$ 是位置位置 $(u,v)$ 处图像的频谱，$i$ 是虚数单位。

频谱 $F(u,v)$ 是表示图像的每个频率分量的振幅和相位的复值函数。我们可以将频谱可视化为 2D 图，其中每个点的强度表示相应频率分量的振幅。

为了从频谱中获得二进制码，我们可以使用以下阈值函数：
$$
\begin{equation} g(u,v) = \begin{cases} 1 & |F(u,v)| > T \ 0 & |F(u,v)| \leq T \end{cases} \end{equation}
$$
其中，$g(u,v)$ 是位置 $(u,v)$ 处的二进制码，$|F(u,v)|$ 是位置 $(u,v)$ 处的频率分量的大小，$T$ 是阈值。

阈值 $T$ 确定二进制代码中保留的细节级别。高阈值导致二进制码具有更少的比特和更少的细节，而低阈值导致二进制代码具有更多的比特和更多的细节。

傅里叶变换的技术原理可以使用以下数学公式来描述：
$$
\begin{equation} F(u,v) = \sum_{x=0}^{N-1} \sum_{y=0}^{N-1} f(x,y) e^{-i 2 \pi (ux/N+vy/N)} \end{equation}
$$
其中，$f(x,y)$ 是位置 $(x,y)$ 处的图像强度，$F(u,v)$ 是位置位置 $(u,v)$ 处图像的频率分量，$N$ 是图像的大小。

在图像哈希中，可以使用简单的汉明距离度量来比较傅里叶变换生成的二进制码。汉明距离测量两个二进制码之间的比特差的数量，它提供了相应图像之间的相似性度量。具有相似内容的图像将具有彼此相似的二进制码，因此，它们的汉明距离将很小。

在实践中，傅里叶变换经常与其他技术结合使用，以生成更鲁棒和更具鉴别性的图像散列。例如，我们可以将傅里叶变换应用于图像的不同颜色通道，或者我们可以针对不同频带使用不同的阈值，以捕获关于图像的更多信息。

总体而言，傅里叶变换是分析和处理频域信号和图像的有力工具。在图像哈希中，它提供了一种生成可用于识别类似图像的紧凑和有区别的二进制代码的方法。

```python
# 傅里叶变换的示例代码
import numpy as np
from PIL import Image

# Load image
img = Image.open('example_image.jpg').convert('L') # convert to grayscale
width, height = img.size

# Compute 2D Fourier transform of image
img_fft = np.fft.fft2(img)

# Apply logarithm and shift to center of spectrum
img_spectrum = np.log(1 + np.abs(img_fft))
img_spectrum = np.fft.fftshift(img_spectrum)

# Apply threshold to spectrum to generate binary hash
threshold = 0.5 * np.max(img_spectrum)
img_hash = np.where(img_spectrum > threshold, 1, 0)

print(img_hash)
```



